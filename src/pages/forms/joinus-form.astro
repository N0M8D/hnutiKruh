---
import { Icon } from 'astro-icon/components';
import Layout from '@layouts/Page.astro';
import { Button, FormInput, TextSection, Container } from "@components/odyssey-theme";

// Generate next 5 Wednesdays
const getNextWednesdays = () => {
  const wednesdays = [];
  let date = new Date();
  while (wednesdays.length < 5) {
    date.setDate(date.getDate() + 1);
    if (date.getDay() === 3) { // Wednesday is 3
      wednesdays.push(new Date(date));
    }
  }
  return wednesdays;
};

const availableDates = getNextWednesdays();
---

<Layout>
  <Container>
    <TextSection narrow>
      <div class="involvement-form">
        <h1>Zapoj se do Hnutí Kruh</h1>
        <p>Rádi se s tebou setkáme online a představíme ti možnosti zapojení do našeho hnutí.</p>
        
        <form name="Involvement Form" method="POST" action="/api/get-involved">
          <div class="form-container">
            <FormInput name="Jmeno" placeholder="Jméno" required />
            <FormInput name="Prijmeni" placeholder="Příjmení" required />
            <FormInput name="Email" type="email" placeholder="hello@example.com" required />
            <FormInput name="Telefon" type="tel" placeholder="+420 123 456 789" required />
            
            <div class="select-wrapper">
              <label for="meetingDate">Vyber termín online schůzky:</label>
              <select name="meetingDate" id="meetingDate" required>
                <option value="">Vyber termín</option>
                {availableDates.map(date => (
                  <option value={date.toISOString()}>
                    {date.toLocaleDateString('cs-CZ', {
                      weekday: 'long',
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric'
                    })}
                  </option>
                ))}
              </select>
            </div>

            <div class="checkbox-wrapper">
              <label>
                <input type="checkbox" name="newsletter" value="true">
                Chci dostávat newsletter s novinkami
              </label>
            </div>

            <div class="checkbox-wrapper">
              <label>
                <input type="checkbox" name="gdprConsent" required>
                Souhlasím se zpracováním osobních údajů*
              </label>
            </div>

            <Button customIcon fullWidth>
              Odeslat
              <Fragment slot="icon">
                <Icon name="ic:baseline-chevron-right" />
              </Fragment>
            </Button>
          </div>

          <p class="form-disclaimer">
            *Odesláním formuláře souhlasíte se zpracováním vašich osobních údajů pro účely komunikace ohledně zapojení do Hnutí Kruh. Více informací o zpracování osobních údajů najdete v našich Zásadách ochrany osobních údajů.
          </p>
        </form>
      </div>
    </TextSection>
  </Container>
</Layout>

<style>
.involvement-form {
  margin: 2rem 0;
}

.form-container {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
  margin-top: 2rem;
}

.select-wrapper {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.select-wrapper select {
  padding: 0.5rem;
  border: 1px solid var(--theme-border);
  border-radius: 0.25rem;
  background-color: var(--theme-surface-1);
}

.checkbox-wrapper {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.checkbox-wrapper input[type="checkbox"] {
  width: 1.25rem;
  height: 1.25rem;
}

.form-disclaimer {
  margin-top: 1rem;
  font-size: 0.875rem;
  color: #666;
  line-height: 1.4;
}

@media (min-width: 768px) {
  .form-container {
    grid-template-columns: 1fr 1fr;
  }
  
  /* Full width items */
  .form-container > :nth-child(n+3) {
    grid-column: span 2;
  }
}
</style>